<!DOCTYPE html>
<html>
  <head>
    <title>Textio</title>
    <meta name="version" content="1.25">
    <!--<base href="/textio/">-->
    <script>
      if (window.location.protocol === "file:") {
        // Local file system, set base to current directory
        document.write('<base href="./">');
      } else {
        // Deployed, set base to /textio/
        document.write('<base href="/textio/">');
      }
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="manifest" href="manifest.json">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <link rel="icon" type="image/png" href="assets/favicons/textio.png"> 
    <link rel="stylesheet" href="style.css">

		<script>
      if ('serviceWorker' in navigator) {
          navigator.serviceWorker
              .register('service-worker.js') // Correct the hyphen here
              .then(function() {
                  console.log("Service Worker Registered");
              })
              .catch(function(error) {
                  console.error("Service Worker Registration Failed:", error); // Add error handling
              });
      }
  
      window.addEventListener('DOMContentLoaded', () => {
          const parsedUrl = new URL(window.location);
          
          const sharedTitle = parsedUrl.searchParams.get('title');
          const sharedText = parsedUrl.searchParams.get('text');
          const sharedUrl = parsedUrl.searchParams.get('url');
  
          // Ensure `textareaMain` is properly assigned
          //const textareaMain = document.getElementById('textareaMain');
          if (textareaMain) {
              let finalText = ''; // Accumulate shared content

              if (sharedTitle) {
                  finalText += sharedTitle + "\n";
                  console.log('sharedTitle:', sharedTitle);
              }
  
              if (sharedText) {
                  finalText += sharedText + "\n";
                  console.log('sharedText:', sharedText);
              }
              
              if (sharedUrl) {
                  finalText += sharedUrl + "\n";
                  console.log('sharedUrl:', sharedUrl);
              }
  
              textareaMain.value = finalText; // Assign all at once
          } else {
              console.error('textareaMain element not found.');
          }
        });
    </script>  
    
	</head>

	<body>

		<main>
			<section>
				<nav>        
					<button id="goBack" onclick="HistoryBack();" disabled>Step back</button>
	
					<select id="navButtonsOpen" onChange="if(this.value){eval(this.value)}; this.selectedIndex = '0'; this.blur();" style="max-width:85px">
						<option value="">-Open-</option>
            <option value="ClickHiddenFileInput()">From file</option>
            <optgroup id="optgroupLcRecords" label="from LC:"></optgroup>           						
						<!--<option value="LoadFile('slovicka-en.txt')" value="">Open file from server</option>-->
					</select>          

					<input id="fileInputHidden" type='file' style="visibility:hidden;display:none;" onchange="ReadFile(event)" />
					
					<select id="navButtonsSave" onChange="if(this.value){eval(this.value)}; this.selectedIndex = '0'; this.blur();" style="max-width:85px">
						<option value="">-Save-</option>
            <option value="SaveOpenedRecord()">Save (overwrite)</option>
            <option value="SaveAsNewToLs()">Save as new</option>
            <!--<option value="">Save to</option>-->
            <option value="DownloadFile()">Download</option>				
					</select>

          <button id="btnToggleSettingsSection" onclick="ToggleVisibility('#section-app-settings', this.id)">Settings</button>
					
					<br>
					<span>Current step:<em id="currentStep">0</em></span>
          <span>Document: <em id="currentDocName"></em></span>
				</nav>
			</section>			
			
			<section id="editor-textarea-main">
				<textarea id="textareaMain"></textarea>
			</section>

			<section id="editor-buttons">
				<select id="navButtonsTools" onChange="if(this.value){eval(this.value)}; this.selectedIndex = '0'; this.blur();" style="max-width:105px">
					<option value="">Transform</option>
					<option value="Transform(LinesToList);">Rows to List</option>
					<option value="Transform(ListToArray);">List to Array</option>
					<option value="Transform(ListToLines);">List to Rows</option>
					<option value="Transform(ListSort);">Sort list</option>
					<option value="Transform(RemoveSpaces);">Remove spaces</option>
					<option value="Transform(RemoveEmptyLines);">Remove empty rows</option>  		
					<option value="Transform(RemoveLineBreaks);">Remove line breaks</option>
					<option value="Transform(RemoveDiacritics);">Remove diacritics</option>
					<option value="Transform(EncodeBase64)">Encode Base64</option>
					<option value="Transform(DecodeBase64)">Decode Base64</option>
					<option value="Transform(ConvertToSlug);">Convert to Slug</option>
					<option value="Transform(ParseMarkdownLinks)">Parse markdown links</option>
					<option value="Transform(IncreaseLineBreaks);">TTS: increase line breaks</option>
					<option value="Transform(TTSedit);">TTS: dot end, lowerCase, capitilize</option>
					<option value="Transform(ExcelColumnsToJSONMap);">2 excel columns to JSON map</option>      
					<option value="Transform(EncodeUri)">Encode URL</option>
					<option value="Transform(DecodeUri)">Decode URL</option>	      
				</select>
				
				<button onclick="CreateFlashCards()" class='orange'>Play flash cards</button>
        <br>        
        <button id="btnToggleTtsSection" onclick="ToggleVisibility('#tts-controls', this.id)">Show speech</button>
			</section>

			<section id="tts-controls" class="expandable-section" style="display: none;">
				<nav>
					Voice: 
          <select id="tts-voices"></select></br>
					Rate: 
					<select id="tts-rate">
						<option value="0.3">very slow</option>
						<option value="0.6">slow</option>
						<option value="1" selected>normal</option>
						<option value="1.5">fast</option>
						<option value="1.8">very fast</option>
					</select>
					Pitch:
					<select id="tts-pitch">
						<option value="0">low</option>
						<option value="1" selected>normal</option>
						<option value="2">high</option>
					</select></br>
          Flash cards auto-speak: 
          <input type="checkbox" id="checkbox-auto-speak">
          <br>
          <br>
					<button id="tts-play" onclick="Speak(textareaMain.value)">Speak</button>
					<button id="tts-reset" onclick="speechSynthesis.cancel()">Stop</button>
          <br>
				</naV>
			</section>

      <section id="section-app-settings" class="expandable-section" style="display: none;">
        <nav>
          <button id="btnToggleCustomCodeSection" onclick="ToggleVisibility('#editor-textarea-custom', this.id)">Show custom code</button>
          <br>
          <button id="button-enable-logs" onclick="ToggleVisibility('#section-logs', this.id)">Show logs</button>
          <br>          
          <button id="button-remove-ls-item" onclick="RemoveLsRecord()">Remove LS item</button>
          <br>
          <button id="button-clear-ls" onclick="ClearLS()">Clear LS</button>
          <br>
        </nav>
			</section>

      <section id="editor-textarea-custom" class="expandable-section" style="display: none;">
				<textarea id="textareaEval"></textarea>    
				<button onclick="EvalCustomScript();">Execute custom script</button>
			</section>
			
			<section id="flashcards-section" style="display: none;">    
				<article class="card-front"></article>
				<article class="card-back"></article>
				<nav>
					<button onclick="NextCard()">Next</button>          
					<button onclick="TurnCard()">Turn</button>          
          <br><br>
          <button onclick="Speak(currentCard[0])">Speak</button>
          <br><br>
					<button onclick="CloseFlashCards()" class="btn-close">close</button>
				</nav>    
			</section>

      <section id="section-logs" style="display: none;">
        <textarea id="textarea-logs"></textarea>
			</section>
			
		</main>

    <script src="app.js"></script>		
		
	</body>

</html>
